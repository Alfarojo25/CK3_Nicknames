#########################################
# AC Nickname System - Scripted Triggers
# Base triggers for nickname assignment
#########################################
### AGE REQUIREMENTS ###
ac_age_adult_trigger = {
	age >= 16
}

ac_age_mature_trigger = {
	age >= 20
}

ac_age_veteran_trigger = {
	age >= 30
}

### SKILL RANGES ###
# 0-8: No nickname (too mediocre)
ac_skill_too_low_trigger = {
	trigger_if = {
		limit = {
			exists = scope:skill_type
		}
		scope:skill_type <= 8
	}
	trigger_else = {
		always = no
	}
}

# 9-11: Bad/Incompetent nicknames
ac_skill_is_bad_trigger = {
	OR = {
		AND = {
			diplomacy >= 9
			diplomacy <= 11
		}
		AND = {
			martial >= 9
			martial <= 11
		}
		AND = {
			stewardship >= 9
			stewardship <= 11
		}
		AND = {
			intrigue >= 9
			intrigue <= 11
		}
		AND = {
			learning >= 9
			learning <= 11
		}
	}
}

# 12-16: Medium/Competent nicknames
ac_skill_is_medium_trigger = {
	OR = {
		AND = {
			diplomacy >= 12
			diplomacy <= 16
		}
		AND = {
			martial >= 12
			martial <= 16
		}
		AND = {
			stewardship >= 12
			stewardship <= 16
		}
		AND = {
			intrigue >= 12
			intrigue <= 16
		}
		AND = {
			learning >= 12
			learning <= 16
		}
	}
}

# 17+: Glorious/Legendary nicknames
ac_skill_is_glorious_trigger = {
	OR = {
		diplomacy >= 17
		martial >= 17
		stewardship >= 17
		intrigue >= 17
		learning >= 17
	}
}

# Specific skill checks
ac_diplomacy_bad_trigger = {
	diplomacy >= 9
	diplomacy <= 11
}

ac_diplomacy_medium_trigger = {
	diplomacy >= 12
	diplomacy <= 16
}

ac_diplomacy_glorious_trigger = {
	diplomacy >= 17
}

ac_martial_bad_trigger = {
	martial >= 9
	martial <= 11
}

ac_martial_medium_trigger = {
	martial >= 12
	martial <= 16
}

ac_martial_glorious_trigger = {
	martial >= 17
}

ac_stewardship_bad_trigger = {
	stewardship >= 9
	stewardship <= 11
}

ac_stewardship_medium_trigger = {
	stewardship >= 12
	stewardship <= 16
}

ac_stewardship_glorious_trigger = {
	stewardship >= 17
}

ac_intrigue_bad_trigger = {
	intrigue >= 9
	intrigue <= 11
}

ac_intrigue_medium_trigger = {
	intrigue >= 12
	intrigue <= 16
}

ac_intrigue_glorious_trigger = {
	intrigue >= 17
}

ac_learning_bad_trigger = {
	learning >= 9
	learning <= 11
}

ac_learning_medium_trigger = {
	learning >= 12
	learning <= 16
}

ac_learning_glorious_trigger = {
	learning >= 17
}

### TRAIT CATEGORIES ###
# Congenital traits (heredable)
ac_has_congenital_trait_trigger = {
	OR = {
		# Beauty
		has_trait = beauty_good_3
		has_trait = beauty_good_2
		has_trait = beauty_good_1
		has_trait = beauty_bad_1
		has_trait = beauty_bad_2
		has_trait = beauty_bad_3
		# Intelligence
		has_trait = intellect_good_3
		has_trait = intellect_good_2
		has_trait = intellect_good_1
		has_trait = intellect_bad_1
		has_trait = intellect_bad_2
		has_trait = intellect_bad_3
		# Strength/Health
		has_trait = strong
		has_trait = weak
		has_trait = fecund
		has_trait = infertile
		# Size
		has_trait = giant
		has_trait = dwarf
		has_trait = hunchbacked
		# Other congenital
		has_trait = albino
		has_trait = bleeder
		has_trait = clubfooted
		has_trait = lisping
		has_trait = stuttering
	}
}

# Physical traits (acquired, not heredable)
ac_has_physical_trait_trigger = {
	OR = {
		# Combat wounds
		has_trait = wounded_1
		has_trait = wounded_2
		has_trait = wounded_3
		has_trait = maimed
		has_trait = infirm
		has_trait = incapable
		# Missing body parts
		has_trait = one_eyed
		has_trait = one_legged
		# Disfigurement
		has_trait = disfigured
		has_trait = scarred
		has_trait = great_pox
		# Disabilities
		has_trait = blind
		has_trait = eunuch
		has_trait = leper
	}
}

# Beauty traits
ac_has_beauty_trait_trigger = {
	OR = {
		has_trait = beauty_good_3
		has_trait = beauty_good_2
		has_trait = beauty_good_1
		has_trait = beauty_bad_1
		has_trait = beauty_bad_2
		has_trait = beauty_bad_3
	}
}

# Size traits
ac_has_size_trait_trigger = {
	OR = {
		has_trait = giant
		has_trait = dwarf
	}
}

# Intelligence traits
ac_has_intelligence_trait_trigger = {
	OR = {
		has_trait = intellect_good_3
		has_trait = intellect_good_2
		has_trait = intellect_good_1
		has_trait = intellect_bad_1
		has_trait = intellect_bad_2
		has_trait = intellect_bad_3
	}
}

# Strength traits
ac_has_strength_trait_trigger = {
	OR = {
		has_trait = strong
		has_trait = weak
	}
}

# Disfigurement traits
ac_has_disfigurement_trait_trigger = {
	OR = {
		has_trait = disfigured
		has_trait = scarred
		has_trait = great_pox
		has_trait = maimed
		has_trait = one_eyed
		has_trait = one_legged
		has_trait = blind
		has_trait = eunuch
	}
}

### FAITH FAMILIES ###
# Abrahamic religions
ac_is_abrahamic_faith_trigger = {
	OR = {
		religion = religion:christianity_religion
		religion = religion:islam_religion
		religion = religion:judaism_religion
	}
}

# Eastern religions (Dharmic)
ac_is_eastern_faith_trigger = {
	OR = {
		religion = religion:hinduism_religion
		religion = religion:buddhism_religion
		religion = religion:jainism_religion
	}
}

# Pagan religions
ac_is_pagan_faith_trigger = {
	OR = {
		religion = religion:germanic_religion
		religion = religion:slavic_religion
		religion = religion:baltic_religion
		religion = religion:finno_ugric_religion
		religion = religion:west_african_religion
		religion = religion:akom_religion
		religion = religion:kushitism_religion
		religion = religion:tengrism_religion
		religion = religion:bon_religion
		religion = religion:zunism_religion
		religion = religion:hellenism_religion
		religion = religion:basque_religion
		religion = religion:waaqism_religion
	}
}

# Single/unique religions
ac_is_single_faith_trigger = {
	OR = {
		religion = religion:zoroastrianism_religion
		religion = religion:dualism_religion
		religion = religion:taoism_religion
	}
}

# Specific faith checks
ac_is_christian_trigger = {
	religion = religion:christianity_religion
}

ac_is_catholic_trigger = {
	faith = faith:catholic
}

ac_is_orthodox_trigger = {
	faith = faith:orthodox
}

ac_is_norse_pagan_trigger = {
	faith = faith:norse_pagan
}

ac_is_muslim_trigger = {
	religion = religion:islam_religion
}

ac_is_sunni_trigger = {
	OR = {
		faith = faith:ashari
		faith = faith:maturidi
		faith = faith:mutazila
	}
}

ac_is_shiite_trigger = {
	OR = {
		faith = faith:ismaili
		faith = faith:zayidi
	}
}

ac_is_hindu_trigger = {
	religion = religion:hinduism_religion
}

ac_is_buddhist_trigger = {
	religion = religion:buddhism_religion
}

ac_is_zoroastrian_trigger = {
	religion = religion:zoroastrianism_religion
}

### COMBINED CONDITIONS ###
# Ready for physical nickname (age 16+, has trait)
ac_ready_for_physical_nickname_trigger = {
	ac_age_adult_trigger = yes
	ac_has_physical_trait_trigger = yes
	has_any_nickname = no
}

# Ready for congenital nickname (age 16+, has trait)
ac_ready_for_congenital_nickname_trigger = {
	ac_age_adult_trigger = yes
	ac_has_congenital_trait_trigger = yes
	has_any_nickname = no
}

# Ready for skill nickname (age 20+, skill qualifies)
ac_ready_for_skill_nickname_trigger = {
	ac_age_mature_trigger = yes
	OR = {
		ac_skill_is_bad_trigger = yes
		ac_skill_is_medium_trigger = yes
		ac_skill_is_glorious_trigger = yes
	}
	has_any_nickname = no
}

# Ready for faith nickname (age 20+, correct faith)
ac_ready_for_faith_nickname_trigger = {
	ac_age_mature_trigger = yes
	has_any_nickname = no
	OR = {
		ac_is_abrahamic_faith_trigger = yes
		ac_is_eastern_faith_trigger = yes
		ac_is_pagan_faith_trigger = yes
		ac_is_single_faith_trigger = yes
	}
}

### EXCLUSIONS ###
# Character should not receive nicknames
ac_nickname_blocked_trigger = {
	OR = {
		is_imprisoned = yes		# Currently imprisoned
		is_incapable = yes		# Incapacitated
		has_character_flag = ac_nickname_blocked		# Manual block
	}
}

# Already has a nickname
ac_has_nickname_already_trigger = {
	has_any_nickname = yes
}

### GAME RULE PROBABILITY CHECK ###
# Checks if character passes the probability check based on game rule
ac_nickname_frequency_check_trigger = {
	trigger_if = {
		limit = {
			has_game_rule = {
				name = ac_nickname_frequency
				value = very_rare
			}
		}
		random_percent_chance = {
			chance = 5
		}
	}
	trigger_else_if = {
		limit = {
			has_game_rule = {
				name = ac_nickname_frequency
				value = rare
			}
		}
		random_percent_chance = {
			chance = 10
		}
	}
	trigger_else_if = {
		limit = {
			has_game_rule = {
				name = ac_nickname_frequency
				value = medium
			}
		}
		random_percent_chance = {
			chance = 20
		}
	}
	trigger_else_if = {
		limit = {
			has_game_rule = {
				name = ac_nickname_frequency
				value = common
			}
		}
		random_percent_chance = {
			chance = 30
		}
	}
	trigger_else_if = {
		limit = {
			has_game_rule = {
				name = ac_nickname_frequency
				value = frequent
			}
		}
		random_percent_chance = {
			chance = 40
		}
	}
	trigger_else_if = {
		limit = {
			has_game_rule = {
				name = ac_nickname_frequency
				value = very_frequent
			}
		}
		random_percent_chance = {
			chance = 50
		}
	}
	trigger_else_if = {
		limit = {
			has_game_rule = {
				name = ac_nickname_frequency
				value = high
			}
		}
		random_percent_chance = {
			chance = 60
		}
	}
	trigger_else_if = {
		limit = {
			has_game_rule = {
				name = ac_nickname_frequency
				value = very_high
			}
		}
		random_percent_chance = {
			chance = 75
		}
	}
	trigger_else_if = {
		limit = {
			has_game_rule = {
				name = ac_nickname_frequency
				value = maximum
			}
		}
		random_percent_chance = {
			chance = 100
		}
	}
	trigger_else = {
		# Default fallback (20%)
		random_percent_chance = {
			chance = 20
		}
	}
}

### NICKNAME UNIQUENESS CHECKS ###
# Check if nickname is already used by someone in same religious group
ac_nickname_unique_in_faith_group_trigger = {
	save_temporary_scope_as = checking_character
	NOT = {
		any_living_character = {
			NOT = {
				this = scope:checking_character
			}
			has_any_nickname = yes
			faith = {
				religion = scope:checking_character.faith.religion
			}
			has_variable = ac_current_nickname
			var:ac_current_nickname = scope:checking_character.var:ac_pending_nickname
		}
	}
}

# Check if nickname is already used by someone in same culture group
ac_nickname_unique_in_culture_group_trigger = {
	save_temporary_scope_as = checking_character
	NOT = {
		any_living_character = {
			NOT = {
				this = scope:checking_character
			}
			has_any_nickname = yes
			culture = {
				culture_group = scope:checking_character.culture.culture_group
			}
			has_variable = ac_current_nickname
			var:ac_current_nickname = scope:checking_character.var:ac_pending_nickname
		}
	}
}

### CULTURAL REQUIREMENTS FOR ANIMALS ###
# Bear: Balto-Finnic, Caucasian, East Slavic, South Slavic cultures OR Strong trait
ac_bear_culture_trigger = {
	OR = {
		has_trait = strong
		culture = {
			OR = {
				has_cultural_pillar = heritage_balto_finnic
				has_cultural_pillar = heritage_caucasian
				has_cultural_pillar = heritage_east_slavic
				has_cultural_pillar = heritage_south_slavic
			}
		}
	}
}

# Dragon: Japonic, Tai, Tibetan, Chinese, Hmongic cultures
ac_dragon_culture_trigger = {
	culture = {
		OR = {
			has_cultural_pillar = heritage_japonic
			has_cultural_pillar = heritage_tai
			has_cultural_pillar = heritage_tibetan
			has_cultural_pillar = heritage_chinese
			has_cultural_pillar = heritage_hmongic
		}
	}
}

# Lion: Iranian, West Germanic, Indo-Aryan, Israelite, Eastern Roman cultures OR martial role
ac_lion_culture_trigger = {
	OR = {
		# Cultural requirements
		culture = {
			OR = {
				has_cultural_pillar = heritage_iranian
				has_cultural_pillar = heritage_west_germanic
				has_cultural_pillar = heritage_indo_aryan
				has_cultural_pillar = heritage_israelite
				has_cultural_pillar = heritage_byzantine
			}
		}
		# Or martial role/focus/skill
		has_council_position = councillor_marshal
		has_focus = martial_authority_focus
		has_focus = martial_chivalry_focus
		has_focus = martial_strategy_focus
		martial >= 15
	}
}

# Snake: Spymaster role OR intrigue education/focus
ac_snake_role_trigger = {
	OR = {
		has_council_position = councillor_spymaster
		has_focus = intrigue_intimidation_focus
		has_focus = intrigue_temptation_focus
		# Intrigue education
		has_trait = education_intrigue_1
		has_trait = education_intrigue_2
		has_trait = education_intrigue_3
		has_trait = education_intrigue_4
		intrigue >= 15
	}
}

# Wolf: Marshal role OR martial education/focus
ac_wolf_role_trigger = {
	OR = {
		has_council_position = councillor_marshal
		has_focus = martial_authority_focus
		has_focus = martial_chivalry_focus
		has_focus = martial_strategy_focus
		# Martial education
		has_trait = education_martial_1
		has_trait = education_martial_2
		has_trait = education_martial_3
		has_trait = education_martial_4
		martial >= 15
	}
}

# Knight and Color nicknames: Order member OR Marshal role OR high martial/prowess
ac_knight_color_trigger = {
	OR = {
		# Member of a holy order
		has_trait = order_member
		# Or Marshal role
		has_council_position = councillor_marshal
		# Or martial focus
		has_focus = martial_authority_focus
		has_focus = martial_chivalry_focus
		has_focus = martial_strategy_focus
		# Or martial education
		has_trait = education_martial_1
		has_trait = education_martial_2
		has_trait = education_martial_3
		has_trait = education_martial_4
		# Or high martial skill (15+)
		martial >= 15
		# Or high prowess (good fighter, 14+)
		prowess >= 14
	}
}

### MARTIAL RELIGIOUS NICKNAMES - FAITH SPECIFIC ###
# Christianity: Holy warriors and crusaders
ac_faith_christianity_martial_trigger = {
	# Must be Christian
	faith = {
		religion_tag = christianity_religion
	}
	# And have martial prowess/traits
	OR = {
		has_trait = holy_warrior		# Faithful Blade
		has_trait = crusader_king		# Holy Monarch
		has_trait = order_member		# Crusader/Order Member
		AND = {
			has_trait = devoted			# Faithful Blade
			prowess >= 12
		}
	}
}

# Germanic/Norse: Berserkers and faithful warriors
ac_faith_germanic_martial_trigger = {
	# Must be Germanic faith
	faith = {
		religion_tag = germanic_religion
	}
	# And be berserker or devoted warrior
	OR = {
		has_trait = berserker
		AND = {
			has_trait = devoted			# Faithful Blade
			prowess >= 12
		}
	}
}

# Islam: Hajj pilgrims and faithful warriors
ac_faith_islam_martial_trigger = {
	# Must be Islamic faith
	faith = {
		religion_tag = islam_religion
	}
	# And be hajji or devoted warrior
	OR = {
		has_trait = hajjaj
		AND = {
			has_trait = devoted			# Faithful Blade
			prowess >= 12
		}
	}
}

# Generic: Warrior of faith or devoted warrior
ac_faith_generic_martial_trigger = {
	# For other faiths
	OR = {
		has_trait = faith_warrior		# Warrior of the Faith
		AND = {
			has_trait = devoted			# Faithful Blade
			prowess >= 12
		}
	}
}
